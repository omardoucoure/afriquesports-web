# Axolotl Configuration for afrique-v1 LoRA Adapter
# AFCON 2025 Match Commentary Training
# Base Model: Qwen/Qwen2.5-VL-7B-Instruct

base_model: Qwen/Qwen2.5-VL-7B-Instruct
model_type: AutoModelForCausalLM
tokenizer_type: AutoTokenizer

# Trust remote code (required for Qwen models)
trust_remote_code: true

# Training Data
datasets:
  - path: /workspace/afcon2025_training.jsonl
    type: chat_template
    chat_template: chatml
    field_messages: messages
    message_field_role: role
    message_field_content: content

# Dataset Preparation
dataset_prepared_path: /workspace/prepared_data
val_set_size: 0.05
output_dir: /workspace/lora-adapters/afrique-v1

# LoRA Configuration
adapter: lora
lora_model_dir:
lora_r: 64
lora_alpha: 128
lora_dropout: 0.05
lora_target_modules:
  - q_proj
  - k_proj
  - v_proj
  - o_proj
  - gate_proj
  - up_proj
  - down_proj

# QLoRA (4-bit quantization for memory efficiency)
load_in_4bit: true
bnb_4bit_compute_dtype: bfloat16
bnb_4bit_use_double_quant: true
bnb_4bit_quant_type: nf4

# Sequence Length
sequence_len: 2048
sample_packing: true
pad_to_sequence_len: true

# Training Hyperparameters
micro_batch_size: 4
gradient_accumulation_steps: 4
num_epochs: 3
optimizer: paged_adamw_8bit
lr_scheduler: cosine
learning_rate: 0.0002

# Warmup & Logging
warmup_steps: 100
evals_per_epoch: 4
saves_per_epoch: 2
logging_steps: 10

# Precision
bf16: auto
fp16: false
tf32: true

# Gradient Settings
gradient_checkpointing: true
max_grad_norm: 0.3

# Flash Attention (if available)
flash_attention: true
flash_attn_cross_entropy: false
flash_attn_rms_norm: false

# Batch Settings
eval_batch_size: 4
eval_sample_packing: false

# Early Stopping
early_stopping_patience: 3

# Weights & Biases (disable if not using)
wandb_project:
wandb_entity:
wandb_watch:
wandb_name: afrique-v1-training
wandb_log_model:

# Special Tokens
special_tokens:
  pad_token: <|endoftext|>

# Hub Upload (optional - comment out if not using)
# hub_model_id:
# hub_strategy: every_save

# Misc
weight_decay: 0.0
group_by_length: true
debug:
deepspeed:
